{"remainingRequest":"D:\\Program Files\\workspace\\Web前端路线\\VUE\\integration-vue3.0\\node_modules\\babel-loader\\lib\\index.js!D:\\Program Files\\workspace\\Web前端路线\\VUE\\integration-vue3.0\\src\\api\\http.js","dependencies":[{"path":"D:\\Program Files\\workspace\\Web前端路线\\VUE\\integration-vue3.0\\src\\api\\http.js","mtime":1555586237808},{"path":"D:\\Program Files\\workspace\\Web前端路线\\VUE\\integration-vue3.0\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\Program Files\\workspace\\Web前端路线\\VUE\\integration-vue3.0\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _JSON$stringify from \"D:\\\\Program Files\\\\workspace\\\\Web\\u524D\\u7AEF\\u8DEF\\u7EBF\\\\VUE\\\\integration-vue3.0\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/json/stringify\";\nimport _Promise from \"D:\\\\Program Files\\\\workspace\\\\Web\\u524D\\u7AEF\\u8DEF\\u7EBF\\\\VUE\\\\integration-vue3.0\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/promise\";\nimport axios from 'axios';\nimport qs from 'qs';\nimport { Message } from 'element-ui';\nimport store from '@/store';\nimport err_msg from './err_msg'; //请求超时 10ms\n\naxios.defaults.timeout = 10000; //它会自动判断环境 取决于 nmp run (sreve,build) \n//踩坑 baseURL(URL全大写) 不要写成 baseUrl\n\naxios.defaults.baseURL = process.env.VUE_APP_URL; // console.log(axios.defaults.baseURL);\n\naxios.get = function (url, params) {\n  return axios.request({\n    url: url,\n    method: 'get',\n    params: params || {}\n  });\n}; //处理客户端请求\n\n\naxios.interceptors.request.use(function (config) {\n  //qs 可以将{username:\"oldkeyset\",password:\"123456\"} 转换为 usernmae=oldkeyset&password=123456\n  // config.params = qs.stringify(config.params); \n  // config.cancelToken = \"test\";\n  // console.log(config.params);\n  // console.log(config.method);\n  // console.log(config.headers);\n  // console.log(config);\n  //get 请求 一般用来获取数据 默认headers 默认为空\n  var peerid = store.state.auth_info.peerid;\n\n  if (config.method === 'get') {\n    //可以根据项目需求在这里添加 额外参数\n    config.params.peerid = peerid;\n  } else if (config.method === 'post') {\n    config.data = qs.stringify(config.data);\n    config.headers.user_token = \"\";\n    config.headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\n  }\n\n  return config;\n}, function (err) {\n  return _Promise.reject(err);\n}); //处理服务端的返回的结果\n\naxios.interceptors.response.use(function (response) {\n  //data 主要是服务端封装的返回结果\n  //我封装的是 \n  //status: 状态码\n  //msg 单条的消息 或者错误消息\n  //data Object类型 一般放返回的是 对象或list 或 map\n  var data = response.data; //200就为正常的 可以返回data.data\n\n  if (data.status !== 200) {\n    //2051 登录态过期 2052 账号被挤出(异地登录) 4101信息过期\n    if (data.status === 2051 || data.status === 2052 || data.status === 4101) {//跳转到登录页\n    } else {\n      //错误处理\n      try {\n        //获取baseURL 后面的地址 \n        //其它异常进来这里适配\n        //let reqUrl = response.config.url.slice(process.env.VUE_APP_URL.length, response.config.url.length).split('/');\n        //用户登录后的操作 store.getters.config_err_info从数据库获取error信息,统一适配\n        //字段为请求路径  对应错误信息\n        //未登陆直接走catch\n        var errInfo = err_msg; //store.getters.config_err_info \n\n        var resData = JSON.parse(_JSON$stringify(data)); // for (let i = 0; i < reqUrl.length; i++) {\n        //   const e = reqUrl[i]\n        //   errInfo = errInfo[e]\n        // }\n\n        resData.msg = errInfo[resData.msg] || resData.msg; //resData 主要将msg 修改为用户能够识别的提示信息 其它信息不变\n\n        return _Promise.reject(resData);\n      } catch (error) {\n        //try中人为异常会进这里\n        Message({\n          showClose: true,\n          message: err_msg[data.msg] || data.msg,\n          type: 'error'\n        });\n        return _Promise.reject(data);\n      }\n    }\n  }\n\n  return data.data;\n}, function (error) {\n  //这里拦截到的一般是http默认状态码  系统异常  例如服务器挂了\n  return _Promise.reject({\n    msg: error.response.status || error.status\n  });\n});\nexport default axios;",{"version":3,"sources":["D:\\Program Files\\workspace\\Web前端路线\\VUE\\integration-vue3.0\\src\\api\\http.js"],"names":["axios","qs","Message","store","err_msg","defaults","timeout","baseURL","process","env","VUE_APP_URL","get","url","params","request","method","interceptors","use","config","peerid","state","auth_info","data","stringify","headers","user_token","err","reject","response","status","errInfo","resData","JSON","parse","msg","error","showClose","message","type"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,EAAP,MAAe,IAAf;AACA,SAASC,OAAT,QAAwB,YAAxB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,OAAOC,OAAP,MAAoB,WAApB,C,CACA;;AACAJ,KAAK,CAACK,QAAN,CAAeC,OAAf,GAAyB,KAAzB,C,CACA;AACA;;AACAN,KAAK,CAACK,QAAN,CAAeE,OAAf,GAAyBC,OAAO,CAACC,GAAR,CAAYC,WAArC,C,CACA;;AAGAV,KAAK,CAACW,GAAN,GAAY,UAACC,GAAD,EAAMC,MAAN,EAAiB;AAC3B,SAAOb,KAAK,CAACc,OAAN,CAAc;AACnBF,IAAAA,GAAG,EAAEA,GADc;AAEnBG,IAAAA,MAAM,EAAE,KAFW;AAGnBF,IAAAA,MAAM,EAAEA,MAAM,IAAI;AAHC,GAAd,CAAP;AAKD,CAND,C,CAOA;;;AACAb,KAAK,CAACgB,YAAN,CAAmBF,OAAnB,CAA2BG,GAA3B,CAA+B,UAAAC,MAAM,EAAI;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAIC,MAAM,GAAGhB,KAAK,CAACiB,KAAN,CAAYC,SAAZ,CAAsBF,MAAnC;;AACA,MAAID,MAAM,CAACH,MAAP,KAAkB,KAAtB,EAA6B;AAC3B;AACAG,IAAAA,MAAM,CAACL,MAAP,CAAcM,MAAd,GAAuBA,MAAvB;AACD,GAHD,MAGO,IAAID,MAAM,CAACH,MAAP,KAAkB,MAAtB,EAA8B;AAEnCG,IAAAA,MAAM,CAACI,IAAP,GAAcrB,EAAE,CAACsB,SAAH,CAAaL,MAAM,CAACI,IAApB,CAAd;AACAJ,IAAAA,MAAM,CAACM,OAAP,CAAeC,UAAf,GAA4B,EAA5B;AAEAP,IAAAA,MAAM,CAACM,OAAP,CAAe,cAAf,IAAiC,mCAAjC;AACD;;AACD,SAAON,MAAP;AACD,CArBD,EAsBE,UAAAQ,GAAG,EAAI;AACL,SAAO,SAAQC,MAAR,CAAeD,GAAf,CAAP;AACD,CAxBH,E,CA0BA;;AACA1B,KAAK,CAACgB,YAAN,CAAmBY,QAAnB,CAA4BX,GAA5B,CAAgC,UAAAW,QAAQ,EAAI;AAC1C;AACA;AACA;AACA;AACA;AACA,MAAIN,IAAI,GAAGM,QAAQ,CAACN,IAApB,CAN0C,CAMhB;;AAC1B,MAAIA,IAAI,CAACO,MAAL,KAAgB,GAApB,EAAyB;AACvB;AACA,QAAIP,IAAI,CAACO,MAAL,KAAgB,IAAhB,IAAwBP,IAAI,CAACO,MAAL,KAAgB,IAAxC,IAAgDP,IAAI,CAACO,MAAL,KAAgB,IAApE,EAA0E,CACxE;AACD,KAFD,MAEO;AACL;AACA,UAAI;AACF;AACA;AACA;AACA;AACA;AACA;AACA,YAAIC,OAAO,GAAG1B,OAAd,CAPE,CAOoB;;AAEtB,YAAI2B,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAW,gBAAeX,IAAf,CAAX,CAAd,CATE,CAUF;AACA;AACA;AACA;;AACAS,QAAAA,OAAO,CAACG,GAAR,GAAcJ,OAAO,CAACC,OAAO,CAACG,GAAT,CAAP,IAAwBH,OAAO,CAACG,GAA9C,CAdE,CAeF;;AACA,eAAO,SAAQP,MAAR,CAAeI,OAAf,CAAP;AACD,OAjBD,CAiBE,OAAOI,KAAP,EAAc;AACd;AACAjC,QAAAA,OAAO,CAAC;AACNkC,UAAAA,SAAS,EAAE,IADL;AAENC,UAAAA,OAAO,EAAEjC,OAAO,CAACkB,IAAI,CAACY,GAAN,CAAP,IAAqBZ,IAAI,CAACY,GAF7B;AAGNI,UAAAA,IAAI,EAAE;AAHA,SAAD,CAAP;AAKA,eAAO,SAAQX,MAAR,CAAeL,IAAf,CAAP;AACD;AACF;AACF;;AACD,SAAOA,IAAI,CAACA,IAAZ;AACD,CA1CD,EA2CE,UAAAa,KAAK,EAAI;AACP;AACA,SAAO,SAAQR,MAAR,CAAe;AACpBO,IAAAA,GAAG,EAAEC,KAAK,CAACP,QAAN,CAAeC,MAAf,IAAyBM,KAAK,CAACN;AADhB,GAAf,CAAP;AAGD,CAhDH;AAmDA,eAAe7B,KAAf","sourcesContent":["import axios from 'axios';\r\nimport qs from 'qs';\r\nimport { Message } from 'element-ui'\r\nimport store from '@/store'\r\nimport err_msg from './err_msg';\r\n//请求超时 10ms\r\naxios.defaults.timeout = 10000;\r\n//它会自动判断环境 取决于 nmp run (sreve,build) \r\n//踩坑 baseURL(URL全大写) 不要写成 baseUrl\r\naxios.defaults.baseURL = process.env.VUE_APP_URL;\r\n// console.log(axios.defaults.baseURL);\r\n\r\n\r\naxios.get = (url, params) => {\r\n  return axios.request({\r\n    url: url,\r\n    method: 'get',\r\n    params: params || {}\r\n  });\r\n};\r\n//处理客户端请求\r\naxios.interceptors.request.use(config => {\r\n  //qs 可以将{username:\"oldkeyset\",password:\"123456\"} 转换为 usernmae=oldkeyset&password=123456\r\n  // config.params = qs.stringify(config.params); \r\n  // config.cancelToken = \"test\";\r\n  // console.log(config.params);\r\n  // console.log(config.method);\r\n  // console.log(config.headers);\r\n  // console.log(config);\r\n  //get 请求 一般用来获取数据 默认headers 默认为空\r\n  let peerid = store.state.auth_info.peerid\r\n  if (config.method === 'get') {\r\n    //可以根据项目需求在这里添加 额外参数\r\n    config.params.peerid = peerid;\r\n  } else if (config.method === 'post') {\r\n\r\n    config.data = qs.stringify(config.data);\r\n    config.headers.user_token = \"\";\r\n\r\n    config.headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\";\r\n  }\r\n  return config;\r\n},\r\n  err => {\r\n    return Promise.reject(err);\r\n  }\r\n);\r\n//处理服务端的返回的结果\r\naxios.interceptors.response.use(response => {\r\n  //data 主要是服务端封装的返回结果\r\n  //我封装的是 \r\n  //status: 状态码\r\n  //msg 单条的消息 或者错误消息\r\n  //data Object类型 一般放返回的是 对象或list 或 map\r\n  let data = response.data; //200就为正常的 可以返回data.data\r\n  if (data.status !== 200) {\r\n    //2051 登录态过期 2052 账号被挤出(异地登录) 4101信息过期\r\n    if (data.status === 2051 || data.status === 2052 || data.status === 4101) {\r\n      //跳转到登录页\r\n    } else {\r\n      //错误处理\r\n      try {\r\n        //获取baseURL 后面的地址 \r\n        //其它异常进来这里适配\r\n        //let reqUrl = response.config.url.slice(process.env.VUE_APP_URL.length, response.config.url.length).split('/');\r\n        //用户登录后的操作 store.getters.config_err_info从数据库获取error信息,统一适配\r\n        //字段为请求路径  对应错误信息\r\n        //未登陆直接走catch\r\n        let errInfo = err_msg;//store.getters.config_err_info \r\n        \r\n        let resData = JSON.parse(JSON.stringify(data));\r\n        // for (let i = 0; i < reqUrl.length; i++) {\r\n        //   const e = reqUrl[i]\r\n        //   errInfo = errInfo[e]\r\n        // }\r\n        resData.msg = errInfo[resData.msg] || resData.msg;\r\n        //resData 主要将msg 修改为用户能够识别的提示信息 其它信息不变\r\n        return Promise.reject(resData);\r\n      } catch (error) {\r\n        //try中人为异常会进这里\r\n        Message({\r\n          showClose: true,\r\n          message: err_msg[data.msg] || data.msg,\r\n          type: 'error'\r\n        });\r\n        return Promise.reject(data);\r\n      }\r\n    }\r\n  }\r\n  return data.data;\r\n},\r\n  error => {\r\n    //这里拦截到的一般是http默认状态码  系统异常  例如服务器挂了\r\n    return Promise.reject({\r\n      msg: error.response.status || error.status\r\n    })\r\n  }\r\n);\r\n\r\nexport default axios;\r\n"]}]}